on:
  pull_request:
    branches:
      - main
  push:
    branches:
      - main
name: Flint CI
jobs:
  flint_checks:
    steps:
      - uses: actions/checkout@v4
        name: Checkout code
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          ref: ${{ github.event.pull_request.head.ref || github.ref_ame }}
          persist-credentials: false
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
      - uses: actions/setup-node@v3
        name: Install Node.js
        with:
          node-version: 18.x
      - name: Install Node.js dependencies
        run: npm install -g @stylistic/eslint-config@latest @stylistic/eslint-plugin@latest @stylistic/eslint-plugin-js@latest @stylistic/eslint-plugin-jsx@latest eslint@latest jest@latest --no-fund --no-audit --silent
      - uses: robinraju/release-downloader@v1
        name: Install Flint
        with:
          latest: true
          repository: skadewdl3/flint
          fileName: flint
          out-file-path: .
          prerelease: true
      - env:
          GEMINI_BASE_URL: ${{ secrets.GEMINI_BASE_URL }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          MODEL: gemini-2.0-flash
        name: Run Tests
        run: "        chmod +x ./flint\n        ./flint install\n        ./flint test --test\n        "
      - env:
          GH_TOKEN: "${{ secrets.GITHUB_TOKEN }} "
        name: Comment AI Suggestions
        run: "        if [ -f reports/temp.md ]; then\n        gh pr comment ${{ github.event.pull_request.number }} --body \"$(cat reports/temp.md)\"\n        else\n        echo \"AI suggestions not found, skipping PR comment.\"\n        fi\n        "
      - uses: actions/upload-artifact@v4
        name: Upload Test Results
        with:
          name: Test Results
          path: reports
      - uses: actions/upload-artifact@v4
        name: Upload Logs
        with:
          name: Logs
          path: logs.txt
    name: Flint Checks
    runs-on: ubuntu-latest
